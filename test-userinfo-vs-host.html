<!doctype html>
<!--
Original:

http://trac.webkit.org/browser/trunk/LayoutTests/fast/url/segments-userinfo-vs-host.html
-->
<base id=base>
<script src=url.js></script>
<script>
var cases = [
    // These cases currently match between WebKit and Gecko, so the results should probably never change.
    ["http:@www.example.com", "http://www.example.com/", ["http:","www.example.com","","/","",""]],
    ["http:/@www.example.com", "http://www.example.com/", ["http:","www.example.com","","/","",""]],
    ["http://@www.example.com", "http://www.example.com/", ["http:","www.example.com","","/","",""]],
    ["http:a:b@www.example.com", "http://a:b@www.example.com/", ["http:","www.example.com","","/","",""]],
    ["http:/a:b@www.example.com", "http://a:b@www.example.com/", ["http:","www.example.com","","/","",""]],
    ["http://a:b@www.example.com", "http://a:b@www.example.com/", ["http:","www.example.com","","/","",""]],
    ["http://@pple.com", "http://pple.com/", ["http:","pple.com","","/","",""]],
    ["http::b@www.example.com", "http://:b@www.example.com/", ["http:","www.example.com","","/","",""]],
    ["http:/:b@www.example.com", "http://:b@www.example.com/", ["http:","www.example.com","","/","",""]],
    ["http://:b@www.example.com", "http://:b@www.example.com/", ["http:","www.example.com","","/","",""]],

    // Gecko and WebKit both treat this URLs as invalid, but Gecko reports "http:" as protocol.
    ["http:/:@/www.example.com", "http:/:@/www.example.com", [":","","","","",""]],

    // HTTP URLs with an empty host are invalid, because otherwise, there is just too much risk that another parsing pass (possibly by a network layer with a subtly different algorithm) would treat path as hostname.
    ["http://user@/www.example.com", "http://user@/www.example.com", [":","","","","",""]], // Regression test for <https://bugs.webkit.org/show_bug.cgi?id=57220>.
    ["http:@/www.example.com", "http:@/www.example.com", [":","","","","",""]], // Regression test for <https://bugs.webkit.org/show_bug.cgi?id=104919>.
    ["http:/@/www.example.com", "http:/@/www.example.com", [":","","","","",""]],
    ["http://@/www.example.com", "http://@/www.example.com", [":","","","","",""]],
    ["https:@/www.example.com", "https:@/www.example.com", [":","","","","",""]], // Regression test for <https://bugs.webkit.org/show_bug.cgi?id=104919>.
    ["http:a:b@/www.example.com", "http:a:b@/www.example.com", [":","","","","",""]],
    ["http:/a:b@/www.example.com", "http:/a:b@/www.example.com", [":","","","","",""]],
    ["http://a:b@/www.example.com", "http://a:b@/www.example.com", [":","","","","",""]],

    // Gecko treats this URL as relative. WebKit treats it as invalid, because of empty host.
    ["http::@/www.example.com", "http::@/www.example.com", [":","","","","",""]],

    // Empty password. Gecko still adds a ':', WebKit does not.
    ["http:a:@www.example.com", "http://a@www.example.com/", ["http:","www.example.com","","/","",""]],
    ["http:/a:@www.example.com", "http://a@www.example.com/", ["http:","www.example.com","","/","",""]],
    ["http://a:@www.example.com", "http://a@www.example.com/", ["http:","www.example.com","","/","",""]],

    // Some tests for multiple @-signs. WebKit treats these URLs as invalid, while Gecko allows '@' in userinfo, searching for the last instance in authority as a delimiter.
    /* URL Standard: follow Gecko
    ["http://a:b@www.@pple.com/p@th", "http://a:b@www.@pple.com/p@th", [":","","","","",""]],
    ["http://www.@@pple.com", "http://www.@@pple.com", [":","","","","",""]],
    ["http://@@pple.com", "http://@@pple.com", [":","","","","",""]],
    ["http://@@@pple.com", "http://@@@pple.com", [":","","","","",""]],
    ["http:@@/www.example.com", "http:@@/www.example.com", [":","","","","",""]],
    ["http:/@@/www.example.com", "http:/@@/www.example.com", [":","","","","",""]],
    ["http://@@/www.example.com", "http://@@/www.example.com", [":","","","","",""]],
    ["http:@:b@www.example.com", "http:@:b@www.example.com", [":","","","","",""]],
    ["http:/@:b@www.example.com", "http:/@:b@www.example.com", [":","","","","",""]],
    ["http://@:b@www.example.com", "http://@:b@www.example.com", [":","","","","",""]],
    */

    // Gecko escapes '.' in username, WebKit does not.
    ["http://www.@pple.com", "http://www.@pple.com/", ["http:","pple.com","","/","",""]],

    // Invalid in WebKit. Gecko thinks that hostname is ":www.example.com", which doesn't seem like a good idea.
    ["http:@:www.example.com", "http:@:www.example.com", [":","","","","",""]],
    ["http:/@:www.example.com", "http:/@:www.example.com", [":","","","","",""]],
    ["http://@:www.example.com", "http://@:www.example.com", [":","","","","",""]],

    // Invalid in Gecko. WebKit just treats this as a URL with empty username and password, which appears to make sense.
    ["http://:@www.example.com", "http://www.example.com/", ["http:","www.example.com","","/","",""]],

    // Host is empty, but hostname is not, so the resulting parsed URL string is not particularly ambiguous.
    // Gecko builds the same parsed URL string, although its components are different.
    // FIXME: Unsure why we are getting a "0" as port here, but it probably doesn't matter for such an edge case.
    /* URL Standard: no host means failure
    ["http:@:/www.example.com", "http://:/www.example.com", ["http:","","0","/www.example.com","",""]],
    ["http:/@:/www.example.com", "http://:/www.example.com", ["http:","","0","/www.example.com","",""]],
    ["http://@:/www.example.com", "http://:/www.example.com", ["http:","","0","/www.example.com","",""]],
    ["http:@:80/www.example.com", "http://:80/www.example.com", ["http:","","80","/www.example.com","",""]],
    */
];

function setBase(base) {
  document.getElementById("base").href = base
}

function bURL(url, base) {
  base = base || "about:blank"
  setBase(base)
  var a = document.createElement("a")
  a.setAttribute("href", url)
  return a
}


function compare(url, expected) {

}

function test(input, expected, serialization) {
  url = new URL(input)
  if(url.protocol != expected[0] ||
     url.hostname != expected[1] ||
     url.port != expected[2] ||
     url.pathname != expected[3] ||
     url.search != expected[4] ||
     url.hash != expected[5]) {
    document.write("Got: " + url.protocol + "," + url.hostname + "," + url.port + "," + url.pathname + "," + url.search + "," + url.hash + ", expected: " + expected + ", for input:" + input + "<br>")
  }
  /* XXX https://bugs.webkit.org/show_bug.cgi?id=118344
  if(url.href != serialization) {
    document.write("Got (serialization): " + url.href + ", expected: " + serialization + "<br>")
  }
  */

  url = bURL(input)
  if(url.protocol != expected[0] ||
     url.hostname != expected[1] ||
     url.port != expected[2] ||
     url.pathname != expected[3] ||
     url.search != expected[4] ||
     url.hash != expected[5]) {
    document.write("BROWSER Got: " + url.protocol + "," + url.hostname + "," + url.port + "," + url.pathname + "," + url.search + "," + url.hash + ", expected: " + expected + ", for input:" + input + "<br>")
  }
  /*
  if(url.href != serialization) {
    document.write("BROWSER Got (serialization): " + url.href + ", expected: " + serialization + "<br>")
  }
  */
}

for (var i = 0; i < cases.length; ++i) {
  test(cases[i][0], cases[i][2], cases[i][1])
}
</script>
